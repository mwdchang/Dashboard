<!DOCTYPE html>
<html>
<head>
<title>Zoom timeline test</title>
<script src="bower_components/d3/d3.js" charset="utf-8"></script>
<style>
body {
  margin: 2rem;
  font-family: Tahoma;
  font-size: 1.0rem;
}

.axis {
  font-size: 0.75rem;
}

.axis line {
  stroke: #000;
  stroke-width: 3px
}

.axis path {
  fill: none;
  stroke-width: 3px;
  stroke: #222;
}


</style>
</head>
<body>
  <h2> Test zoomable Timeline </h2>
  <input type="button" value="Reset"></input>
  <br><br>
  <svg id="canvas"></svg>
</body>
<script>
var parse = d3.time.format("%Y-%m-%d").parse;

var w = 800;
var h = 300;
var startTime = parse('2015-01-01');
var endTime = parse('2015-12-31');

var svg = d3.select('#canvas').attr('width', w).attr('height', h);
var vis = svg.append('g');
// var scale = d3.time.scale().domain([startTime, endTime]).range([0, 500]).nice();
var scale = d3.time.scale().domain([startTime, endTime]).range([0, 700]);


var xaxis = d3.svg.axis().scale(scale).orient('bottom')
  .ticks(4)
  .tickSize(6)
  .tickFormat(d3.time.format('%Y-%m-%d'));

var zoom = d3.behavior.zoom();
zoom.scaleExtent([1, 10]);
zoom.on('zoom', function() {
  // Try to prevent default double tap semantics here
  if ( ! d3.event.sourceEvent) return;
  console.log('zooming...', d3.event);
  zoomed();
});

zoom.x(scale);

function zoomed() {
  // Don't scroll past start
  var t = zoom.translate();
  var tx = t[0], ty=t[1];
  tx = Math.min(tx, 0);
  zoom.translate([tx, ty]);
  d3.select('.blah').call(xaxis);
}

var zoomArea = vis.append('rect')
  .attr('x', 50)
  .attr('y', 10)
  .attr('width', 700)
  .attr('height', 100)
  .style('fill', '#C96')
  .call(zoom)
  .on('dblclick.zoom', null);

// Reset zoom
d3.select('input').on('click', function() {
  d3.transition().duration(500).tween("zoom", function() {
    var ix = d3.interpolate(scale.domain(), [startTime, endTime]);
    return function(t) {
      zoom.x(scale.domain(ix(t)));
      zoomed();
    }
  });
});

vis.append('g')
  .attr('transform', 'translate(50, 115)')
  .classed('axis', true)
  .classed('blah', true)
  .call(xaxis);

</script>
</html>
